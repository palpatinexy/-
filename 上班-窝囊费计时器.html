<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šç­-çªå›Šè´¹è®¡æ—¶å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e68aff 0%, #0984e3 50%, #6c5ce7 100%);
            height: 100vh;
            color: white;
            padding: 10px;
            overflow: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            min-height: 0;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .settings-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .time-setting {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .time-setting h3 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: #e68aff;
        }

        .time-input-row {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .time-input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 6px 8px;
            color: white;
            font-size: 0.9rem;
            text-align: center;
            width: 50px;
        }

        .salary-setting {
            grid-column: span 2;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .salary-input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: white;
            font-size: 1rem;
            width: 120px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, #d22eff, #00a085);
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 184, 148, 0.6);
        }

        .period-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            flex: 1;
            min-height: 0;
        }

        .period-card.morning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
            border-left: 4px solid #ffc107;
        }

        .period-card.afternoon {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(103, 58, 183, 0.2));
            border-left: 4px solid #9c27b0;
        }

        .period-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .period-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .period-time {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .countdown-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .countdown-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .countdown-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .countdown-value {
            font-size: 1.3rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .countdown-value.finished {
            color: #d22eff;
            animation: celebration 1s infinite;
        }

        .progress-section {
            margin: 10px 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            height: 18px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            height: 100%;
            border-radius: 20px;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar.morning {
            background: linear-gradient(90deg, #ffc107, #ff9800);
        }

        .progress-bar.afternoon {
            background: linear-gradient(90deg, #9c27b0, #673ab7);
        }

        .earnings-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            flex-shrink: 0;
        }

        .earnings-title {
            font-size: 1rem;
            margin-bottom: 8px;
            color: #d22eff;
        }

        .earnings-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #d22eff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .earnings-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .earnings-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .earnings-item-value {
            font-size: 1rem;
            font-weight: bold;
            color: #e68aff;
        }

        .earnings-item-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 3px;
        }

        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
        }

        .status-indicator.active {
            background: #d22eff;
            animation: pulse 2s infinite;
        }

        .status-indicator.finished {
            background: #e68aff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .earnings-details {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .title {
                font-size: 1.5rem;
            }

            .countdown-row {
                grid-template-columns: 1fr;
            }

            .earnings-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1 class="title">ğŸ’¼ ä¸‹ç­å€’è®¡æ—¶</h1>
        <p class="subtitle">ğŸ˜¢ å¿«ç‚¹ä¸‹ç­å§</p>
    </div>

    <div class="main-content">
        <div class="left-panel">
            <!-- è®¾ç½®é¢æ¿ -->
            <div class="settings-panel">
                <div class="settings-grid">
                    <div class="time-setting">
                        <h3>ğŸŒ… ä¸Šåˆæ—¶æ®µ</h3>
                        <div class="time-input-row">
                            <span>å¼€å§‹:</span>
                            <input type="number" class="time-input" id="morningStartHour" placeholder="8" min="0"
                                   max="23" value="8">
                            <span>:</span>
                            <input type="number" class="time-input" id="morningStartMin" placeholder="30" min="0"
                                   max="59" value="30">
                        </div>
                        <div class="time-input-row">
                            <span>ç»“æŸ:</span>
                            <input type="number" class="time-input" id="morningEndHour" placeholder="11" min="0"
                                   max="23" value="11">
                            <span>:</span>
                            <input type="number" class="time-input" id="morningEndMin" placeholder="50" min="0" max="59"
                                   value="50">
                        </div>
                    </div>

                    <div class="time-setting">
                        <h3>ğŸŒ† ä¸‹åˆæ—¶æ®µ</h3>
                        <div class="time-input-row">
                            <span>å¼€å§‹:</span>
                            <input type="number" class="time-input" id="afternoonStartHour" placeholder="13" min="0"
                                   max="23" value="13">
                            <span>:</span>
                            <input type="number" class="time-input" id="afternoonStartMin" placeholder="0" min="0"
                                   max="59" value="0">
                        </div>
                        <div class="time-input-row">
                            <span>ç»“æŸ:</span>
                            <input type="number" class="time-input" id="afternoonEndHour" placeholder="17" min="0"
                                   max="23" value="17">
                            <span>:</span>
                            <input type="number" class="time-input" id="afternoonEndMin" placeholder="30" min="0"
                                   max="59" value="30">
                        </div>
                    </div>

                    <div class="salary-setting">
                        <h3>ğŸ’° æ—¥è–ªè®¾ç½®</h3>
                        <div class="time-input-row">
                            <span>æ—¥è–ª:</span>
                            <input type="number" class="salary-input" id="dailySalary" placeholder="200" min="0"
                                   step="0.01">
                            <span>å…ƒ</span>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn" onclick="updateSettings()">ğŸš€ åº”ç”¨è®¾ç½®</button>
                    <span id="saveStatus" style="font-size: 0.8rem; opacity: 0; transition: opacity 0.3s ease;">âœ… å·²ä¿å­˜</span>
                </div>
            </div>

            <!-- æ”¶å…¥ç»Ÿè®¡ -->
            <div class="earnings-section">
                <div class="earnings-title">ğŸ’° ä»Šæ—¥æ”¶å…¥ç»Ÿè®¡</div>
                <div class="earnings-value" id="totalEarnings">Â¥ 0.00</div>
                <div class="earnings-details">
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="morningEarnings">Â¥ 0.00</div>
                        <div class="earnings-item-label">ä¸Šåˆæ”¶å…¥</div>
                    </div>
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="afternoonEarnings">Â¥ 0.00</div>
                        <div class="earnings-item-label">ä¸‹åˆæ”¶å…¥</div>
                    </div>
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="hourlyRate">Â¥ 0.00</div>
                        <div class="earnings-item-label">æ—¶è–ª</div>
                    </div>
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="minuteRate">Â¥ 0.00</div>
                        <div class="earnings-item-label">åˆ†é’Ÿæ”¶å…¥</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <!-- ä¸Šåˆæ—¶æ®µ -->
            <div class="period-card morning">
                <div class="status-indicator" id="morningStatusIndicator"></div>
                <div class="period-header">
                    <div class="period-title">ğŸŒ… ä¸Šåˆæ—¶æ®µ</div>
                    <div class="period-time" id="morningTimeRange">08:30 - 11:50</div>
                </div>

                <div class="countdown-row">
                    <div class="countdown-item">
                        <div class="countdown-label">è·ç¦»ä¸Šåˆç»“æŸ</div>
                        <div class="countdown-value" id="morningCountdown">--:--:--</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-label">ä¸ŠåˆçŠ¶æ€</div>
                        <div class="countdown-value" id="morningStatusText">æœªå¼€å§‹</div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="progress-header">
                        <span>ä¸Šåˆè¿›åº¦</span>
                        <span id="morningProgress">0%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar morning" id="morningProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- ä¸‹åˆæ—¶æ®µ -->
            <div class="period-card afternoon">
                <div class="status-indicator" id="afternoonStatusIndicator"></div>
                <div class="period-header">
                    <div class="period-title">ğŸŒ† ä¸‹åˆæ—¶æ®µ</div>
                    <div class="period-time" id="afternoonTimeRange">13:00 - 17:30</div>
                </div>

                <div class="countdown-row">
                    <div class="countdown-item">
                        <div class="countdown-label">è·ç¦»ä¸‹åˆç»“æŸ</div>
                        <div class="countdown-value" id="afternoonCountdown">--:--:--</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-label">ä¸‹åˆçŠ¶æ€</div>
                        <div class="countdown-value" id="afternoonStatusText">æœªå¼€å§‹</div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="progress-header">
                        <span>ä¸‹åˆè¿›åº¦</span>
                        <span id="afternoonProgress">0%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar afternoon" id="afternoonProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let workSchedule = {
    morning: { start: null, end: null },
    afternoon: { start: null, end: null },
    dailySalary: 0
};
let updateInterval = null;

// æ˜¾ç¤ºä¿å­˜çŠ¶æ€
function showSaveStatus(message = 'âœ… å·²ä¿å­˜', duration = 2000) {
    const statusElement = document.getElementById('saveStatus');
    if (statusElement) {
        statusElement.textContent = message;
        statusElement.style.opacity = '1';
        setTimeout(() => {
            statusElement.style.opacity = '0';
        }, duration);
    }
}

// ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
function saveSettings() {
    const settings = {
        morningStartHour: parseInt(document.getElementById('morningStartHour').value) || 8,
        morningStartMin: parseInt(document.getElementById('morningStartMin').value) || 30,
        morningEndHour: parseInt(document.getElementById('morningEndHour').value) || 11,
        morningEndMin: parseInt(document.getElementById('morningEndMin').value) || 50,
        afternoonStartHour: parseInt(document.getElementById('afternoonStartHour').value) || 13,
        afternoonStartMin: parseInt(document.getElementById('afternoonStartMin').value) || 00,
        afternoonEndHour: parseInt(document.getElementById('afternoonEndHour').value) || 17,
        afternoonEndMin: parseInt(document.getElementById('afternoonEndMin').value) || 30,
        dailySalary: parseFloat(document.getElementById('dailySalary').value) || 00
    };
    
    localStorage.setItem('workTimerSettings', JSON.stringify(settings));
    console.log('è®¾ç½®å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨:', settings);
    showSaveStatus();
}

// æ¸…é™¤ä¿å­˜çš„è®¾ç½®
function clearSettings() {
    if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰ä¿å­˜çš„è®¾ç½®å—ï¼Ÿè¿™å°†æ¢å¤åˆ°é»˜è®¤å€¼ã€‚')) {
        localStorage.removeItem('workTimerSettings');
        
        // æ¢å¤é»˜è®¤å€¼
        document.getElementById('morningStartHour').value = 8;
        document.getElementById('morningStartMin').value = 30;
        document.getElementById('morningEndHour').value = 11;
        document.getElementById('morningEndMin').value = 50;
        document.getElementById('afternoonStartHour').value = 13;
        document.getElementById('afternoonStartMin').value = 00;
        document.getElementById('afternoonEndHour').value = 17;
        document.getElementById('afternoonEndMin').value = 30;
        document.getElementById('dailySalary').value = '';
        
        console.log('è®¾ç½®å·²æ¸…é™¤ï¼Œæ¢å¤é»˜è®¤å€¼');
        showSaveStatus('ğŸ—‘ï¸ å·²æ¸…é™¤', 2000);
        
        // é‡æ–°åº”ç”¨è®¾ç½®
        updateSettings();
    }
}

// ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®¾ç½®
function loadSettings() {
    try {
        const savedSettings = localStorage.getItem('workTimerSettings');
        if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            console.log('ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®¾ç½®:', settings);
            
            // æ¢å¤ç•Œé¢è®¾ç½®
            document.getElementById('morningStartHour').value = settings.morningStartHour || 8;
            document.getElementById('morningStartMin').value = settings.morningStartMin || 30;
            document.getElementById('morningEndHour').value = settings.morningEndHour || 11;
            document.getElementById('morningEndMin').value = settings.morningEndMin || 50;
            document.getElementById('afternoonStartHour').value = settings.afternoonStartHour || 13;
            document.getElementById('afternoonStartMin').value = settings.afternoonStartMin || 00;
            document.getElementById('afternoonEndHour').value = settings.afternoonEndHour || 17;
            document.getElementById('afternoonEndMin').value = settings.afternoonEndMin || 30;
            document.getElementById('dailySalary').value = settings.dailySalary || 00;
            
            return settings;
        }
    } catch (error) {
        console.error('åŠ è½½è®¾ç½®æ—¶å‡ºé”™:', error);
    }
    return null;
}

// æ›´æ–°è®¾ç½®
function updateSettings() {
    console.log('updateSettings å‡½æ•°è¢«è°ƒç”¨');
    const today = new Date();
    console.log('å½“å‰æ—¶é—´:', today);

    // è·å–ä¸Šåˆæ—¶é—´è®¾ç½®
    const morningStartHour = parseInt(document.getElementById('morningStartHour').value) || 8;
    const morningStartMin = parseInt(document.getElementById('morningStartMin').value) || 30;
    const morningEndHour = parseInt(document.getElementById('morningEndHour').value) || 11;
    const morningEndMin = parseInt(document.getElementById('morningEndMin').value) || 50;

    // è·å–ä¸‹åˆæ—¶é—´è®¾ç½®
    const afternoonStartHour = parseInt(document.getElementById('afternoonStartHour').value) || 13;
    const afternoonStartMin = parseInt(document.getElementById('afternoonStartMin').value) || 0;
    const afternoonEndHour = parseInt(document.getElementById('afternoonEndHour').value) || 17;
    const afternoonEndMin = parseInt(document.getElementById('afternoonEndMin').value) || 30;

    // è·å–æ—¥è–ªè®¾ç½®
    const dailySalary = parseFloat(document.getElementById('dailySalary').value) || 0;

    console.log('è®¾ç½®å‚æ•°:', {
        morningStartHour, morningStartMin, morningEndHour, morningEndMin,
        afternoonStartHour, afternoonStartMin, afternoonEndHour, afternoonEndMin,
        dailySalary
    });

    // ä¿å­˜è®¾ç½®åˆ°æœ¬åœ°å­˜å‚¨
    saveSettings();

    // è®¾ç½®å·¥ä½œæ—¶é—´
    workSchedule.morning.start = new Date(today.getFullYear(), today.getMonth(), today.getDate(), morningStartHour, morningStartMin, 0);
    workSchedule.morning.end = new Date(today.getFullYear(), today.getMonth(), today.getDate(), morningEndHour, morningEndMin, 0);
    workSchedule.afternoon.start = new Date(today.getFullYear(), today.getMonth(), today.getDate(), afternoonStartHour, afternoonStartMin, 0);
    workSchedule.afternoon.end = new Date(today.getFullYear(), today.getMonth(), today.getDate(), afternoonEndHour, afternoonEndMin, 0);
    workSchedule.dailySalary = dailySalary;

    console.log('å·¥ä½œæ—¶é—´è¡¨:', workSchedule);

    // æ›´æ–°æ˜¾ç¤ºçš„æ—¶é—´èŒƒå›´
    document.getElementById('morningTimeRange').textContent = `${formatTime(workSchedule.morning.start)} - ${formatTime(workSchedule.morning.end)}`;
    document.getElementById('afternoonTimeRange').textContent = `${formatTime(workSchedule.afternoon.start)} - ${formatTime(workSchedule.afternoon.end)}`;

    // è®¡ç®—æ—¶è–ªå’Œåˆ†é’Ÿæ”¶å…¥
    const totalWorkMinutes = getTotalWorkMinutes();
    const hourlyRate = totalWorkMinutes > 0 ? (dailySalary / (totalWorkMinutes / 60)) : 0;
    const minuteRate = totalWorkMinutes > 0 ? (dailySalary / totalWorkMinutes) : 0;

    document.getElementById('hourlyRate').textContent = `Â¥ ${hourlyRate.toFixed(2)}`;
    document.getElementById('minuteRate').textContent = `Â¥ ${minuteRate.toFixed(4)}`;

    console.log('æ—¶è–ªè®¡ç®—:', { totalWorkMinutes, hourlyRate, minuteRate });

    // å¼€å§‹æ›´æ–°å€’è®¡æ—¶
    if (updateInterval) {
        clearInterval(updateInterval);
    }
    updateCountdown();
    updateInterval = setInterval(updateCountdown, 1000);
    console.log('å€’è®¡æ—¶å·²å¯åŠ¨');
}

// æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
function formatTime(date) {
    return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
}

// æ ¼å¼åŒ–å€’è®¡æ—¶æ˜¾ç¤º
function formatCountdown(milliseconds) {
    if (milliseconds <= 0) return '00:00:00';

    const hours = Math.floor(milliseconds / (1000 * 60 * 60));
    const minutes = Math.floor((milliseconds % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((milliseconds % (1000 * 60)) / 1000);

    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// è·å–æ€»å·¥ä½œåˆ†é’Ÿæ•°
function getTotalWorkMinutes() {
    const morningMinutes = (workSchedule.morning.end - workSchedule.morning.start) / (1000 * 60);
    const afternoonMinutes = (workSchedule.afternoon.end - workSchedule.afternoon.start) / (1000 * 60);
    return morningMinutes + afternoonMinutes;
}

// æ›´æ–°å€’è®¡æ—¶å’Œè¿›åº¦
function updateCountdown() {
    const now = new Date();

    // æ›´æ–°ä¸Šåˆæ—¶æ®µ
    updatePeriod('morning', now);

    // æ›´æ–°ä¸‹åˆæ—¶æ®µ
    updatePeriod('afternoon', now);

    // æ›´æ–°æ”¶å…¥ç»Ÿè®¡
    updateEarnings(now);
}

// æ›´æ–°å•ä¸ªæ—¶æ®µ
function updatePeriod(period, now) {
    const start = workSchedule[period].start;
    const end = workSchedule[period].end;

    if (!start || !end) return;

    const statusIndicator = document.getElementById(`${period}StatusIndicator`);
    const countdownElement = document.getElementById(`${period}Countdown`);
    const statusTextElement = document.getElementById(`${period}StatusText`);
    const progressElement = document.getElementById(`${period}Progress`);
    const progressBarElement = document.getElementById(`${period}ProgressBar`);

    let status, countdown, progress;

    if (now < start) {
        // æœªå¼€å§‹
        status = 'æœªå¼€å§‹';
        countdown = formatCountdown(start - now);
        progress = 0;
        statusIndicator.className = 'status-indicator';
        countdownElement.className = 'countdown-value';
        if (statusTextElement) statusTextElement.textContent = 'æœªå¼€å§‹';
    } else if (now >= start && now <= end) {
        // è¿›è¡Œä¸­
        status = 'è¿›è¡Œä¸­';
        countdown = formatCountdown(end - now);
        const elapsed = now - start;
        const total = end - start;
        progress = (elapsed / total) * 100;
        statusIndicator.className = 'status-indicator active';
        countdownElement.className = 'countdown-value';
        if (statusTextElement) statusTextElement.textContent = 'è¿›è¡Œä¸­';
    } else {
        // å·²ç»“æŸ
        status = 'å·²å®Œæˆ';
        countdown = '00:00:00';
        progress = 100;
        statusIndicator.className = 'status-indicator finished';
        countdownElement.className = 'countdown-value finished';
        if (statusTextElement) statusTextElement.textContent = 'å·²å®Œæˆ';
    }

    countdownElement.textContent = countdown;
    progressElement.textContent = `${progress.toFixed(1)}%`;
    progressBarElement.style.width = `${progress}%`;
}

// æ›´æ–°æ”¶å…¥ç»Ÿè®¡
function updateEarnings(now) {
    if (workSchedule.dailySalary <= 0) {
        document.getElementById('totalEarnings').textContent = 'Â¥ 0.00';
        document.getElementById('morningEarnings').textContent = 'Â¥ 0.00';
        document.getElementById('afternoonEarnings').textContent = 'Â¥ 0.00';
        return;
    }

    const totalWorkMinutes = getTotalWorkMinutes();
    const minuteRate = workSchedule.dailySalary / totalWorkMinutes;

    // è®¡ç®—ä¸Šåˆæ”¶å…¥
    let morningEarnings = 0;
    const morningStart = workSchedule.morning.start;
    const morningEnd = workSchedule.morning.end;
    if (now > morningStart) {
        const morningWorkedMinutes = Math.min(now - morningStart, morningEnd - morningStart) / (1000 * 60);
        morningEarnings = morningWorkedMinutes * minuteRate;
    }

    // è®¡ç®—ä¸‹åˆæ”¶å…¥
    let afternoonEarnings = 0;
    const afternoonStart = workSchedule.afternoon.start;
    const afternoonEnd = workSchedule.afternoon.end;
    if (now > afternoonStart) {
        const afternoonWorkedMinutes = Math.min(now - afternoonStart, afternoonEnd - afternoonStart) / (1000 * 60);
        afternoonEarnings = afternoonWorkedMinutes * minuteRate;
    }

    const totalEarnings = morningEarnings + afternoonEarnings;

    document.getElementById('totalEarnings').textContent = `Â¥ ${totalEarnings.toFixed(2)}`;
    document.getElementById('morningEarnings').textContent = `Â¥ ${morningEarnings.toFixed(2)}`;
    document.getElementById('afternoonEarnings').textContent = `Â¥ ${afternoonEarnings.toFixed(2)}`;
}

// æ·»åŠ è¾“å…¥éªŒè¯
function addInputValidation() {
    const timeInputs = document.querySelectorAll('.time-input');
    timeInputs.forEach(input => {
        input.addEventListener('input', function() {
            let value = parseInt(this.value);
            if (this.id.includes('Hour')) {
                if (value < 0) this.value = 0;
                if (value > 23) this.value = 23;
            } else {
                if (value < 0) this.value = 0;
                if (value > 59) this.value = 59;
            }
        });
    });

    document.getElementById('dailySalary').addEventListener('input', function() {
        if (parseFloat(this.value) < 0) this.value = 0;
    });
}

// æ·»åŠ è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
function addAutoSave() {
    const inputs = [
        'morningStartHour', 'morningStartMin', 'morningEndHour', 'morningEndMin',
        'afternoonStartHour', 'afternoonStartMin', 'afternoonEndHour', 'afternoonEndMin',
        'dailySalary'
    ];
    
    inputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
            input.addEventListener('change', function() {
                // å»¶è¿Ÿä¿å­˜ï¼Œé¿å…é¢‘ç¹ä¿å­˜
                clearTimeout(input.saveTimeout);
                input.saveTimeout = setTimeout(() => {
                    saveSettings();
                    console.log(`${inputId} å·²è‡ªåŠ¨ä¿å­˜`);
                }, 500);
            });
            
            // æ·»åŠ è¾“å…¥æ—¶çš„å®æ—¶åé¦ˆ
            input.addEventListener('input', function() {
                showSaveStatus('ğŸ’¾ æ­£åœ¨ä¿å­˜...', 1000);
            });
        }
    });
}

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
window.addEventListener('load', function() {
    console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
    
    // åŠ è½½ä¿å­˜çš„è®¾ç½®
    const savedSettings = loadSettings();
    
    addInputValidation();
    addAutoSave();

    // å¦‚æœæœ‰ä¿å­˜çš„è®¾ç½®ï¼Œè‡ªåŠ¨åº”ç”¨
    if (savedSettings) {
        console.log('å‘ç°ä¿å­˜çš„è®¾ç½®ï¼Œè‡ªåŠ¨åº”ç”¨...');
        updateSettings();
    } else {
        console.log('æ²¡æœ‰ä¿å­˜çš„è®¾ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼');
        // ä½¿ç”¨é»˜è®¤å€¼å¹¶ä¿å­˜
        saveSettings();
        updateSettings();
    }

    // æ·»åŠ é”®ç›˜äº‹ä»¶ç›‘å¬
    document.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            updateSettings();
        }
    });
    
    console.log('åˆå§‹åŒ–å®Œæˆ');
});
</script>
</body>
</html>