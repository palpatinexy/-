<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>上班-窝囊费计时器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e68aff 0%, #0984e3 50%, #6c5ce7 100%);
            height: 100vh;
            color: white;
            padding: 10px;
            overflow: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            height: calc(100vh - 20px);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .header {
            text-align: center;
            margin-bottom: 15px;
            flex-shrink: 0;
        }

        .title {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .main-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            min-height: 0;
        }

        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .right-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .settings-panel {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            flex-shrink: 0;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .time-setting {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .time-setting h3 {
            margin-bottom: 10px;
            font-size: 1rem;
            color: #e68aff;
        }

        .time-input-row {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .time-input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 6px 8px;
            color: white;
            font-size: 0.9rem;
            text-align: center;
            width: 50px;
        }

        .salary-setting {
            grid-column: span 2;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .salary-input {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 8px 12px;
            color: white;
            font-size: 1rem;
            width: 120px;
            text-align: center;
        }

        .btn {
            background: linear-gradient(45deg, #d22eff, #00a085);
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.4);
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 20px rgba(0, 184, 148, 0.6);
        }

        .period-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
            flex: 1;
            min-height: 0;
        }

        .period-card.morning {
            background: linear-gradient(135deg, rgba(255, 193, 7, 0.2), rgba(255, 152, 0, 0.2));
            border-left: 4px solid #ffc107;
        }

        .period-card.afternoon {
            background: linear-gradient(135deg, rgba(156, 39, 176, 0.2), rgba(103, 58, 183, 0.2));
            border-left: 4px solid #9c27b0;
        }

        .period-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .period-title {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .period-time {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .countdown-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 12px;
        }

        .countdown-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .countdown-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .countdown-value {
            font-size: 1.3rem;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
        }

        .countdown-value.finished {
            color: #d22eff;
            animation: celebration 1s infinite;
        }

        .progress-section {
            margin: 10px 0;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 6px;
            font-size: 0.85rem;
        }

        .progress-container {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            height: 18px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .progress-bar {
            height: 100%;
            border-radius: 20px;
            transition: width 1s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-bar.morning {
            background: linear-gradient(90deg, #ffc107, #ff9800);
        }

        .progress-bar.afternoon {
            background: linear-gradient(90deg, #9c27b0, #673ab7);
        }

        .earnings-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
            flex-shrink: 0;
        }

        .earnings-title {
            font-size: 1rem;
            margin-bottom: 8px;
            color: #d22eff;
        }

        .earnings-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #d22eff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 10px;
        }

        .earnings-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .earnings-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .earnings-item-value {
            font-size: 1rem;
            font-weight: bold;
            color: #e68aff;
        }

        .earnings-item-label {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 3px;
        }

        .status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e74c3c;
        }

        .status-indicator.active {
            background: #d22eff;
            animation: pulse 2s infinite;
        }

        .status-indicator.finished {
            background: #e68aff;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .earnings-details {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .title {
                font-size: 1.5rem;
            }

            .countdown-row {
                grid-template-columns: 1fr;
            }

            .earnings-details {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1 class="title">💼 下班倒计时</h1>
        <p class="subtitle">😢 快点下班吧</p>
    </div>

    <div class="main-content">
        <div class="left-panel">
            <!-- 设置面板 -->
            <div class="settings-panel">
                <div class="settings-grid">
                    <div class="time-setting">
                        <h3>🌅 上午时段</h3>
                        <div class="time-input-row">
                            <span>开始:</span>
                            <input type="number" class="time-input" id="morningStartHour" placeholder="8" min="0"
                                   max="23" value="8">
                            <span>:</span>
                            <input type="number" class="time-input" id="morningStartMin" placeholder="30" min="0"
                                   max="59" value="30">
                        </div>
                        <div class="time-input-row">
                            <span>结束:</span>
                            <input type="number" class="time-input" id="morningEndHour" placeholder="11" min="0"
                                   max="23" value="11">
                            <span>:</span>
                            <input type="number" class="time-input" id="morningEndMin" placeholder="50" min="0" max="59"
                                   value="50">
                        </div>
                    </div>

                    <div class="time-setting">
                        <h3>🌆 下午时段</h3>
                        <div class="time-input-row">
                            <span>开始:</span>
                            <input type="number" class="time-input" id="afternoonStartHour" placeholder="13" min="0"
                                   max="23" value="13">
                            <span>:</span>
                            <input type="number" class="time-input" id="afternoonStartMin" placeholder="0" min="0"
                                   max="59" value="0">
                        </div>
                        <div class="time-input-row">
                            <span>结束:</span>
                            <input type="number" class="time-input" id="afternoonEndHour" placeholder="17" min="0"
                                   max="23" value="17">
                            <span>:</span>
                            <input type="number" class="time-input" id="afternoonEndMin" placeholder="30" min="0"
                                   max="59" value="30">
                        </div>
                    </div>

                    <div class="salary-setting">
                        <h3>💰 日薪设置</h3>
                        <div class="time-input-row">
                            <span>日薪:</span>
                            <input type="number" class="salary-input" id="dailySalary" placeholder="200" min="0"
                                   step="0.01">
                            <span>元</span>
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; align-items: center;">
                    <button class="btn" onclick="updateSettings()">🚀 应用设置</button>
                    <span id="saveStatus" style="font-size: 0.8rem; opacity: 0; transition: opacity 0.3s ease;">✅ 已保存</span>
                </div>
            </div>

            <!-- 收入统计 -->
            <div class="earnings-section">
                <div class="earnings-title">💰 今日收入统计</div>
                <div class="earnings-value" id="totalEarnings">¥ 0.00</div>
                <div class="earnings-details">
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="morningEarnings">¥ 0.00</div>
                        <div class="earnings-item-label">上午收入</div>
                    </div>
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="afternoonEarnings">¥ 0.00</div>
                        <div class="earnings-item-label">下午收入</div>
                    </div>
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="hourlyRate">¥ 0.00</div>
                        <div class="earnings-item-label">时薪</div>
                    </div>
                    <div class="earnings-item">
                        <div class="earnings-item-value" id="minuteRate">¥ 0.00</div>
                        <div class="earnings-item-label">分钟收入</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <!-- 上午时段 -->
            <div class="period-card morning">
                <div class="status-indicator" id="morningStatusIndicator"></div>
                <div class="period-header">
                    <div class="period-title">🌅 上午时段</div>
                    <div class="period-time" id="morningTimeRange">08:30 - 11:50</div>
                </div>

                <div class="countdown-row">
                    <div class="countdown-item">
                        <div class="countdown-label">距离上午结束</div>
                        <div class="countdown-value" id="morningCountdown">--:--:--</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-label">上午状态</div>
                        <div class="countdown-value" id="morningStatusText">未开始</div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="progress-header">
                        <span>上午进度</span>
                        <span id="morningProgress">0%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar morning" id="morningProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- 下午时段 -->
            <div class="period-card afternoon">
                <div class="status-indicator" id="afternoonStatusIndicator"></div>
                <div class="period-header">
                    <div class="period-title">🌆 下午时段</div>
                    <div class="period-time" id="afternoonTimeRange">13:00 - 17:30</div>
                </div>

                <div class="countdown-row">
                    <div class="countdown-item">
                        <div class="countdown-label">距离下午结束</div>
                        <div class="countdown-value" id="afternoonCountdown">--:--:--</div>
                    </div>
                    <div class="countdown-item">
                        <div class="countdown-label">下午状态</div>
                        <div class="countdown-value" id="afternoonStatusText">未开始</div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="progress-header">
                        <span>下午进度</span>
                        <span id="afternoonProgress">0%</span>
                    </div>
                    <div class="progress-container">
                        <div class="progress-bar afternoon" id="afternoonProgressBar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let workSchedule = {
    morning: { start: null, end: null },
    afternoon: { start: null, end: null },
    dailySalary: 0
};
let updateInterval = null;

// 显示保存状态
function showSaveStatus(message = '✅ 已保存', duration = 2000) {
    const statusElement = document.getElementById('saveStatus');
    if (statusElement) {
        statusElement.textContent = message;
        statusElement.style.opacity = '1';
        setTimeout(() => {
            statusElement.style.opacity = '0';
        }, duration);
    }
}

// 保存设置到本地存储
function saveSettings() {
    const settings = {
        morningStartHour: parseInt(document.getElementById('morningStartHour').value) || 8,
        morningStartMin: parseInt(document.getElementById('morningStartMin').value) || 30,
        morningEndHour: parseInt(document.getElementById('morningEndHour').value) || 11,
        morningEndMin: parseInt(document.getElementById('morningEndMin').value) || 50,
        afternoonStartHour: parseInt(document.getElementById('afternoonStartHour').value) || 13,
        afternoonStartMin: parseInt(document.getElementById('afternoonStartMin').value) || 00,
        afternoonEndHour: parseInt(document.getElementById('afternoonEndHour').value) || 17,
        afternoonEndMin: parseInt(document.getElementById('afternoonEndMin').value) || 30,
        dailySalary: parseFloat(document.getElementById('dailySalary').value) || 00
    };
    
    localStorage.setItem('workTimerSettings', JSON.stringify(settings));
    console.log('设置已保存到本地存储:', settings);
    showSaveStatus();
}

// 清除保存的设置
function clearSettings() {
    if (confirm('确定要清除所有保存的设置吗？这将恢复到默认值。')) {
        localStorage.removeItem('workTimerSettings');
        
        // 恢复默认值
        document.getElementById('morningStartHour').value = 8;
        document.getElementById('morningStartMin').value = 30;
        document.getElementById('morningEndHour').value = 11;
        document.getElementById('morningEndMin').value = 50;
        document.getElementById('afternoonStartHour').value = 13;
        document.getElementById('afternoonStartMin').value = 00;
        document.getElementById('afternoonEndHour').value = 17;
        document.getElementById('afternoonEndMin').value = 30;
        document.getElementById('dailySalary').value = '';
        
        console.log('设置已清除，恢复默认值');
        showSaveStatus('🗑️ 已清除', 2000);
        
        // 重新应用设置
        updateSettings();
    }
}

// 从本地存储加载设置
function loadSettings() {
    try {
        const savedSettings = localStorage.getItem('workTimerSettings');
        if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            console.log('从本地存储加载设置:', settings);
            
            // 恢复界面设置
            document.getElementById('morningStartHour').value = settings.morningStartHour || 8;
            document.getElementById('morningStartMin').value = settings.morningStartMin || 30;
            document.getElementById('morningEndHour').value = settings.morningEndHour || 11;
            document.getElementById('morningEndMin').value = settings.morningEndMin || 50;
            document.getElementById('afternoonStartHour').value = settings.afternoonStartHour || 13;
            document.getElementById('afternoonStartMin').value = settings.afternoonStartMin || 00;
            document.getElementById('afternoonEndHour').value = settings.afternoonEndHour || 17;
            document.getElementById('afternoonEndMin').value = settings.afternoonEndMin || 30;
            document.getElementById('dailySalary').value = settings.dailySalary || 00;
            
            return settings;
        }
    } catch (error) {
        console.error('加载设置时出错:', error);
    }
    return null;
}

// 更新设置
function updateSettings() {
    console.log('updateSettings 函数被调用');
    const today = new Date();
    console.log('当前时间:', today);

    // 获取上午时间设置
    const morningStartHour = parseInt(document.getElementById('morningStartHour').value) || 8;
    const morningStartMin = parseInt(document.getElementById('morningStartMin').value) || 30;
    const morningEndHour = parseInt(document.getElementById('morningEndHour').value) || 11;
    const morningEndMin = parseInt(document.getElementById('morningEndMin').value) || 50;

    // 获取下午时间设置
    const afternoonStartHour = parseInt(document.getElementById('afternoonStartHour').value) || 13;
    const afternoonStartMin = parseInt(document.getElementById('afternoonStartMin').value) || 0;
    const afternoonEndHour = parseInt(document.getElementById('afternoonEndHour').value) || 17;
    const afternoonEndMin = parseInt(document.getElementById('afternoonEndMin').value) || 30;

    // 获取日薪设置
    const dailySalary = parseFloat(document.getElementById('dailySalary').value) || 0;

    console.log('设置参数:', {
        morningStartHour, morningStartMin, morningEndHour, morningEndMin,
        afternoonStartHour, afternoonStartMin, afternoonEndHour, afternoonEndMin,
        dailySalary
    });

    // 保存设置到本地存储
    saveSettings();

    // 设置工作时间
    workSchedule.morning.start = new Date(today.getFullYear(), today.getMonth(), today.getDate(), morningStartHour, morningStartMin, 0);
    workSchedule.morning.end = new Date(today.getFullYear(), today.getMonth(), today.getDate(), morningEndHour, morningEndMin, 0);
    workSchedule.afternoon.start = new Date(today.getFullYear(), today.getMonth(), today.getDate(), afternoonStartHour, afternoonStartMin, 0);
    workSchedule.afternoon.end = new Date(today.getFullYear(), today.getMonth(), today.getDate(), afternoonEndHour, afternoonEndMin, 0);
    workSchedule.dailySalary = dailySalary;

    console.log('工作时间表:', workSchedule);

    // 更新显示的时间范围
    document.getElementById('morningTimeRange').textContent = `${formatTime(workSchedule.morning.start)} - ${formatTime(workSchedule.morning.end)}`;
    document.getElementById('afternoonTimeRange').textContent = `${formatTime(workSchedule.afternoon.start)} - ${formatTime(workSchedule.afternoon.end)}`;

    // 计算时薪和分钟收入
    const totalWorkMinutes = getTotalWorkMinutes();
    const hourlyRate = totalWorkMinutes > 0 ? (dailySalary / (totalWorkMinutes / 60)) : 0;
    const minuteRate = totalWorkMinutes > 0 ? (dailySalary / totalWorkMinutes) : 0;

    document.getElementById('hourlyRate').textContent = `¥ ${hourlyRate.toFixed(2)}`;
    document.getElementById('minuteRate').textContent = `¥ ${minuteRate.toFixed(4)}`;

    console.log('时薪计算:', { totalWorkMinutes, hourlyRate, minuteRate });

    // 开始更新倒计时
    if (updateInterval) {
        clearInterval(updateInterval);
    }
    updateCountdown();
    updateInterval = setInterval(updateCountdown, 1000);
    console.log('倒计时已启动');
}

// 格式化时间显示
function formatTime(date) {
    return `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
}

// 格式化倒计时显示
function formatCountdown(milliseconds) {
    if (milliseconds <= 0) return '00:00:00';

    const hours = Math.floor(milliseconds / (1000 * 60 * 60));
    const minutes = Math.floor((milliseconds % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((milliseconds % (1000 * 60)) / 1000);

    return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
}

// 获取总工作分钟数
function getTotalWorkMinutes() {
    const morningMinutes = (workSchedule.morning.end - workSchedule.morning.start) / (1000 * 60);
    const afternoonMinutes = (workSchedule.afternoon.end - workSchedule.afternoon.start) / (1000 * 60);
    return morningMinutes + afternoonMinutes;
}

// 更新倒计时和进度
function updateCountdown() {
    const now = new Date();

    // 更新上午时段
    updatePeriod('morning', now);

    // 更新下午时段
    updatePeriod('afternoon', now);

    // 更新收入统计
    updateEarnings(now);
}

// 更新单个时段
function updatePeriod(period, now) {
    const start = workSchedule[period].start;
    const end = workSchedule[period].end;

    if (!start || !end) return;

    const statusIndicator = document.getElementById(`${period}StatusIndicator`);
    const countdownElement = document.getElementById(`${period}Countdown`);
    const statusTextElement = document.getElementById(`${period}StatusText`);
    const progressElement = document.getElementById(`${period}Progress`);
    const progressBarElement = document.getElementById(`${period}ProgressBar`);

    let status, countdown, progress;

    if (now < start) {
        // 未开始
        status = '未开始';
        countdown = formatCountdown(start - now);
        progress = 0;
        statusIndicator.className = 'status-indicator';
        countdownElement.className = 'countdown-value';
        if (statusTextElement) statusTextElement.textContent = '未开始';
    } else if (now >= start && now <= end) {
        // 进行中
        status = '进行中';
        countdown = formatCountdown(end - now);
        const elapsed = now - start;
        const total = end - start;
        progress = (elapsed / total) * 100;
        statusIndicator.className = 'status-indicator active';
        countdownElement.className = 'countdown-value';
        if (statusTextElement) statusTextElement.textContent = '进行中';
    } else {
        // 已结束
        status = '已完成';
        countdown = '00:00:00';
        progress = 100;
        statusIndicator.className = 'status-indicator finished';
        countdownElement.className = 'countdown-value finished';
        if (statusTextElement) statusTextElement.textContent = '已完成';
    }

    countdownElement.textContent = countdown;
    progressElement.textContent = `${progress.toFixed(1)}%`;
    progressBarElement.style.width = `${progress}%`;
}

// 更新收入统计
function updateEarnings(now) {
    if (workSchedule.dailySalary <= 0) {
        document.getElementById('totalEarnings').textContent = '¥ 0.00';
        document.getElementById('morningEarnings').textContent = '¥ 0.00';
        document.getElementById('afternoonEarnings').textContent = '¥ 0.00';
        return;
    }

    const totalWorkMinutes = getTotalWorkMinutes();
    const minuteRate = workSchedule.dailySalary / totalWorkMinutes;

    // 计算上午收入
    let morningEarnings = 0;
    const morningStart = workSchedule.morning.start;
    const morningEnd = workSchedule.morning.end;
    if (now > morningStart) {
        const morningWorkedMinutes = Math.min(now - morningStart, morningEnd - morningStart) / (1000 * 60);
        morningEarnings = morningWorkedMinutes * minuteRate;
    }

    // 计算下午收入
    let afternoonEarnings = 0;
    const afternoonStart = workSchedule.afternoon.start;
    const afternoonEnd = workSchedule.afternoon.end;
    if (now > afternoonStart) {
        const afternoonWorkedMinutes = Math.min(now - afternoonStart, afternoonEnd - afternoonStart) / (1000 * 60);
        afternoonEarnings = afternoonWorkedMinutes * minuteRate;
    }

    const totalEarnings = morningEarnings + afternoonEarnings;

    document.getElementById('totalEarnings').textContent = `¥ ${totalEarnings.toFixed(2)}`;
    document.getElementById('morningEarnings').textContent = `¥ ${morningEarnings.toFixed(2)}`;
    document.getElementById('afternoonEarnings').textContent = `¥ ${afternoonEarnings.toFixed(2)}`;
}

// 添加输入验证
function addInputValidation() {
    const timeInputs = document.querySelectorAll('.time-input');
    timeInputs.forEach(input => {
        input.addEventListener('input', function() {
            let value = parseInt(this.value);
            if (this.id.includes('Hour')) {
                if (value < 0) this.value = 0;
                if (value > 23) this.value = 23;
            } else {
                if (value < 0) this.value = 0;
                if (value > 59) this.value = 59;
            }
        });
    });

    document.getElementById('dailySalary').addEventListener('input', function() {
        if (parseFloat(this.value) < 0) this.value = 0;
    });
}

// 添加自动保存功能
function addAutoSave() {
    const inputs = [
        'morningStartHour', 'morningStartMin', 'morningEndHour', 'morningEndMin',
        'afternoonStartHour', 'afternoonStartMin', 'afternoonEndHour', 'afternoonEndMin',
        'dailySalary'
    ];
    
    inputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
            input.addEventListener('change', function() {
                // 延迟保存，避免频繁保存
                clearTimeout(input.saveTimeout);
                input.saveTimeout = setTimeout(() => {
                    saveSettings();
                    console.log(`${inputId} 已自动保存`);
                }, 500);
            });
            
            // 添加输入时的实时反馈
            input.addEventListener('input', function() {
                showSaveStatus('💾 正在保存...', 1000);
            });
        }
    });
}

// 页面加载完成后初始化
window.addEventListener('load', function() {
    console.log('页面加载完成，开始初始化...');
    
    // 加载保存的设置
    const savedSettings = loadSettings();
    
    addInputValidation();
    addAutoSave();

    // 如果有保存的设置，自动应用
    if (savedSettings) {
        console.log('发现保存的设置，自动应用...');
        updateSettings();
    } else {
        console.log('没有保存的设置，使用默认值');
        // 使用默认值并保存
        saveSettings();
        updateSettings();
    }

    // 添加键盘事件监听
    document.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            updateSettings();
        }
    });
    
    console.log('初始化完成');
});
</script>
</body>
</html>